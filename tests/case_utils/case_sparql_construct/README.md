# Tests of CASE SPARQL CONSTRUCT query runner

The tests in this directory confirms `case_sparql_construct` satisfies a base set of expected command line functionality.


## Test 1 - CONSTRUCT from W3C example


### Test procedure

1. Inputs - `w3-input-2.ttl` and `w3-input-3.json` contain a small graph split across two files, and `w3-input-1.sparql` contains a SPARQL `CONSTRUCT` query.
2. Outputs - `w3-output.ttl` is generated by using `case_sparql_construct` to run `w3-input-1.sparql` against the two `w3-input-*.*` graph files.  This affirms that `case_sparql_construct` can read multiple input files of differing formats.
3. Output verification - two name-pairs should have vcard records generated.  The tests `test_w3_templates_with_blank_nodes_result_json()` and `_turtle()` confirm those pairs are in the output graphs.


### References

The data and query used in `w3-input-2.ttl`, `w3-input-3.json` and `w3-input.sparql` are copied from ["SPARQL Query Language for RDF", Section 10.2.1](https://www.w3.org/TR/rdf-sparql-query/#tempatesWithBNodes), with these modifications:
* `w3-input-2.ttl` contains the original example's `_:a` (Alice) records, but drops the `_:b` (Bob) records.
* `w3-input-3.json` is a conversion of the original Turtle example's `_:b` records to JSON-LD.


## Test 2 - CASE subclass inference


### Test procedure

1. Inputs - `subclass.json` contain a small graph with two resources that are `ObservableObject`s.  `kb:file-1` is explicitly an `ObservableObject`.  `kb:file-2` is implicitly an `ObservableObject`, by way of `File` being a subclass of `ObservableObject`.  `subclass.sparql` queries for all `ObservableObject`s, to construct an additional extending statement that they are also [`prov:Entity`](https://www.w3.org/TR/prov-o/#Entity)s.
2. Outputs - `subclass-implicit-any.ttl` is the constructed graph that uses CASE's subclass hierarchy.  `subclass-explicit-none.ttl` is the constructed graph that foregoes any implicit CASE ontology structure, via the `--built-version none` flag.
3. Output verification - See the tests `test_subclass_templates_result_default_case` and `test_subclass_templates_result_no_case`, that verify foregoing the CASE subclass structure means one node is missed by the `CONSTRUCT` query.
